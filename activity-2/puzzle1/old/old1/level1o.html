<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>المستوى الأول - بازل بانحناء</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      background: url('images/back1.png') no-repeat center center fixed;
      background-size: cover;
      font-family: sans-serif;
      overflow: hidden;
      height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    .board {
      display: grid;
      grid-template-columns: repeat(2, 150px);
      grid-template-rows: repeat(2, 150px);
      gap: 10px;
      margin-bottom: 30px;
      position: relative;
    }
    .drop-zone {
      width: 150px;
      height: 150px;
      background-color: #fff;
      border: 2px dashed #aaa;
    }
    .pieces {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: center;
    }
    .piece {
      width: 150px;
      height: 150px;
      background-image: url('images/puzzle1.png');
      background-size: 300px 300px;
      border: 2px solid #999;
      cursor: grab;
    }
    .piece.tl { border-top-left-radius: 50% 30%; }
    .piece.tr { border-top-right-radius: 50% 30%; }
    .piece.bl { border-bottom-left-radius: 50% 30%; }
    .piece.br { border-bottom-right-radius: 50% 30%; }

    .controls {
      margin-top: 20px;
      display: flex;
      gap: 20px;
    }
    .controls img {
      width: 120px;
      cursor: pointer;
      transition: transform 0.2s;
    }
    .controls img:hover {
      transform: scale(1.1);
    }
    .controls.hidden { display: none; }

    .balloon {
      position: absolute;
      bottom: -100px;
      width: 40px;
      height: 60px;
      background: radial-gradient(circle at 30% 30%, #f66, #c00);
      border-radius: 50% 50% 40% 40%;
      animation: float 3s linear forwards;
    }
    @keyframes float {
      0% { bottom: -100px; opacity: 1; }
      100% { bottom: 100vh; opacity: 0; }
    }
    #fullImage {
      position: absolute;
      width: 300px;
      height: 300px;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 10;
      display: none;
    }
  </style>
</head>
<body>
  <div class="board" id="dropZoneBoard">
    <div class="drop-zone" data-pos="0"></div>
    <div class="drop-zone" data-pos="1"></div>
    <div class="drop-zone" data-pos="2"></div>
    <div class="drop-zone" data-pos="3"></div>
  </div>

  <div class="pieces" id="piecesContainer"></div>

  <div class="controls hidden" id="controlButtons">
    <img src="images/again.png" alt="استمرار" onclick="window.location.reload()" />
    <img src="images/home.png" alt="الرئيسية" onclick="goHome()" />
  </div>

  <img id="fullImage" src="images/puzzle1.png" alt="الصورة الكاملة">

  <audio id="bravoSound" src="sounds/bravo.mp3"></audio>
  <audio id="correctSound" src="sounds/correct.mp3"></audio>
  <audio id="wrongSound" src="sounds/wrong.mp3"></audio>

  <script>
    const dropZones = document.querySelectorAll(".drop-zone");
    const piecesContainer = document.getElementById("piecesContainer");
    const bravoSound = document.getElementById("bravoSound");
    const correctSound = document.getElementById("correctSound");
    const wrongSound = document.getElementById("wrongSound");
    const controlButtons = document.getElementById("controlButtons");
    const fullImage = document.getElementById("fullImage");

    const positions = [
      { pos: 0, x: 0, y: 0, cls: "tl" },
      { pos: 1, x: -150, y: 0, cls: "tr" },
      { pos: 2, x: 0, y: -150, cls: "bl" },
      { pos: 3, x: -150, y: -150, cls: "br" }
    ];

    const shuffled = [...positions].sort(() => Math.random() - 0.5);
    shuffled.forEach(p => {
      const div = document.createElement("div");
      div.className = `piece ${p.cls}`;
      div.setAttribute("draggable", true);
      div.setAttribute("data-pos", p.pos);
      div.style.backgroundPosition = `${p.x}px ${p.y}px`;
      div.addEventListener("dragstart", dragStart);
      piecesContainer.appendChild(div);
    });

    function dragStart(e) {
      e.dataTransfer.setData("text/plain", e.target.dataset.pos);
    }

    dropZones.forEach(zone => {
      zone.addEventListener("dragover", e => e.preventDefault());
      zone.addEventListener("drop", function (e) {
        e.preventDefault();
        const draggedPos = e.dataTransfer.getData("text/plain");
        const correctPos = this.dataset.pos;
        const piece = document.querySelector(`.piece[data-pos='${draggedPos}']`);

        if (!piece || this.firstChild) return;

        if (draggedPos === correctPos) {
          this.appendChild(piece);
          piece.style.cursor = "default";
          correctSound.play();
          checkCompletion();
        } else {
          wrongSound.play();
          piecesContainer.appendChild(piece);
        }
      });
    });

    function checkCompletion() {
      const completed = Array.from(dropZones).every(zone => {
        return zone.firstChild && zone.dataset.pos === zone.firstChild.dataset.pos;
      });

      if (completed) {
        bravoSound.play();
        showFullImage();
        launchBalloons();
        setTimeout(() => controlButtons.classList.remove("hidden"), 2000);
      }
    }

    function showFullImage() {
      fullImage.style.display = "block";
    }

    function launchBalloons() {
      for (let i = 0; i < 20; i++) {
        const b = document.createElement("div");
        b.className = "balloon";
        b.style.left = Math.random() * 90 + "%";
        b.style.animationDuration = (2 + Math.random() * 2) + "s";
        document.body.appendChild(b);
        setTimeout(() => b.remove(), 4000);
      }
    }

    function goHome() {
      window.location.href = "levels.html";
    }
  </script>
</body>
</html>
